<div class="movie-details">
  <h1><strong class="title font-comic-sans-MS"><%= @movie.title %></strong><br>
    <small><strong class="smaller-title font-comic-sans-MS"><%= @movie.orig_title + ' (' + @movie.year.to_s + ')' %></strong></small>
  </h1>
<% if @movie.image_url == nil
     imgPath = String.new('/assets/images/movies/noposter.png')
     else
     imgPath = @movie.image_url
     end %>
     <img src="<%= imgPath %>" alt="<%= @movie.orig_title %>" class="img-thumbnail poster">
  <table class="about-movie-table">
    <tr>
      <% list = ''; @movie.countries.each do |item| list += item.name + ', ' end; %>
      <td>Страна:</td>
      <td><%=  list[0, list.length-2] %></td>

    </tr>
    <tr>
      <% list = ''; @movie.genres.each do |item| list += item.name + ', ' end; %><% list = ''; @movie.directors.each do |item| list += item.name + ', ' end; %>
      <td>Жанр:</td>
      <td><%= list[0, list.length-2] %></td>
    </tr>
    <tr>
      <td>Дата премьеры:</td>
      <td><%= @movie.release_date.to_s %></td>
    </tr>
    <tr>
      <td>Продолжительность:</td>
      <td><%= @movie.duration.to_s %> мин.</td>
    </tr>
    <tr>
      <td>Ограничение:</td>
      <td><%= @movie.rate_id.to_s %></td>
    </tr>
    <tr>
      <% list = ''; @movie.directors.each do |item| list += item.name + ', ' end; %>
      <td>Режиссер:</td>
      <td><%= list[0, list.length-2] %></td>
    </tr>
    <tr>
      <% list = ''; @movie.producers.each do |item| list += item.name + ', ' end; %>
      <td>Продюсер:</td>
      <td><%= list[0, list.length-2] %></td>
    </tr>
    <tr>
      <% list = ''; @movie.writers.each do |item| list += item.name + ', ' end; %>
      <td>Сценарист:</td>
      <td><%= list[0, list.length-2] %></td>
    </tr>
    <tr>
      <% list = ''; @movie.stars.each do |item| list += item.name + ', ' end; %>
      <td>Актерский состав:</td>
      <td><%= list[0, list.length-2] %></td>
    </tr>
</table>

  <table>
    <tr>
      <td>
          <p class="font-georgia"><%= @movie.description %></p>
        <p><strong>Пользовательский рейтинг: </strong>
          <% if @movie.ratings.count == 0 %>
              еще никто не проголосовал
          <% else %>
              <%= @movie.ratings.average(:value).round(2)%>
          <% end %>
        </p>
        <p><strong>Число голосов: </strong> <%= @movie.ratings.count %> </p>
      </td>
    </tr>
  </table>
  <% if user_signed_in? && current_user.permission == 1 %>
      <%= link_to 'Редактировать данные', '/edit_movie/'+@movie.id.to_s, :class => 'btn btn-link' %>
      <%= link_to 'Удалить фильм', '/destroy_movie/'+@movie.id.to_s, :class => 'btn btn-link' %>
  <% end %>
</div>
<div class="panel-review">
  <h2 class="mb-0 cntr"><small><strong class="film-review title font-comic-sans-MS">Отзывы пользователей:</strong></small></h2>
  <% if user_signed_in? && @movie.reviews.where(user_id: current_user.id).count == 0 %>
      <%= link_to create_review_path(:review => { :movie_id => @movie.id , :user_id => current_user.id}), class:'btn btn-success' do %>
          <span class="glyphicon glyphicon-plus" aria-hidden="true"></span> Добавить отзыв
      <% end %>
  <% end %>
  <% if @movie.reviews.size == 0 then %>
      <div class="cntr"><div class="btn btn-warning disabled btn-nav-size btn-no-review-color"><strong>ОТЗЫВОВ ЕЩЕ НЕТ</strong></div></div>
  <% else %>
      <table class="reviews">
        <% @movie.reviews.each do |review| %>
            <tr>
              <td>
                <div class="review <%= review.recommended ? 'review-title-user-good' : 'review-title-user-bad' %>">
                  <% if user_signed_in? && (review.user_id==current_user.id || current_user.permission == 1 ) then%>
                      <%= link_to '/edit_review/'+review.id.to_s, :class => 'btn btn-default btn-sm' do %>
                          <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span>
                      <% end %>
                      <%= link_to '/destroy_review/'+review.id.to_s, :class => 'btn btn-danger btn-sm' do %>
                          <span class="glyphicon glyphicon-minus" aria-hidden="true"></span>
                      <% end %>
                  <% end %>
                  <h4 class="mb-0 mt-0 font-size-16"><strong><%= review.title %></strong></h4>
                  <p class="mb-0 mt-0 font-georgia font-size-13 review <%= review.recommended ? 'review-text-good' : 'review-text-bad' %>"><%= review.content %></p>
                  <i class="font-size-12"><%= @users.find(review.user_id).email %>, <%= review.review_date.to_s %></i>
                </div>
              </td>
            </tr>
        <% end %>
      </table>
  <% end %>
</div>